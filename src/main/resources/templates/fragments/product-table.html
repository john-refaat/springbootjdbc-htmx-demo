<html xmlns:th="http://www.thymeleaf.org">

<div id="empty-product-table" th:fragment="empty-product-table">
    <div class="empty-state">
        <i class="fas fa-box-open"></i>
        <h3>No Products Loaded</h3>
        <p>Click "Load Products" to fetch products from the database</p>
    </div>
</div>

<div id="product-table" th:fragment="product-table"
     th:hx-get="@{/products(currentPage=${productsWithDetails.currentPage},pageSize=${productsWithDetails.pageSize})}"
     hx-trigger="refresh-products from:body">
    <div class="table-responsive">
        <table class="table">
            <thead>
            <tr>
                <th>Title</th>
                <th>Vendor</th>
                <th>Type</th>
                <th>Variants</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product : ${productsWithDetails.products}"
                th:attr="data-product-id=${product.uid}">
                <td th:text="${product.title}"></td>
                <td><span class="badge badge-primary" th:text="${product.vendor}"></span></td>
                <td><span th:unless="${#strings.isEmpty(product.productType)}" class="badge type-badge"
                          th:text="${product.productType}"></span></td>
                <td>
                    <div class="variants-grid"  th:id="'variants-' + ${product.uid}"
                         th:unless="${#lists.isEmpty(product.variants)}">
                        <div th:replace="~{fragments/variants-list :: variants-list(${product})}"></div>
                    </div>
                </td>
                <td>
                    <img th:unless="${product.displayImage == null}"
                         th:src="${product.displayImage.src}" th:alt="${product.title}"
                         class="product-image">
                </td>
                <td>
                    <div class="action-buttons-stack">
                        <button class="btn btn-sm btn-primary" title="Edit" hx-trigger="click"
                                hx-target="#forms-container" th:attr="hx-get=@{/products/{uid}/edit(uid=${product.uid})}"
                                hx-swap="innerHTML show:top">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-success" title="Add variant" hx-trigger="click"
                                hx-target="#forms-container" th:attr="hx-get=@{/products/{uid}/variants/create(uid=${product.uid})}"
                                hx-swap="innerHTML show:top">
                            <i class="fas fa-plus"></i> Add variant
                        </button>
                        <button class="btn btn-sm btn-danger" title="Delete"
                                hx-trigger="click"
                                th:attr="data-product-uid=${product.uid},data-product-title=${product.title}"
                                th:hx-get="@{/products/{uid}/delete(uid=${product.uid})}"
                                hx-target="#delete-product-confirm"
                                hx-swap="innerHTML">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="pagination-controls d-flex justify-content-between align-items-center mt-3">
            <div class="page-info">
                Page <span th:text="${productsWithDetails.currentPage + 1}"></span> of
                <span th:text="${productsWithDetails.totalPages}"></span>
                <select class="form-select d-inline-block ms-2"
                        style="width: auto;"
                        name="pageSize"
                        hx-get="/products"
                        hx-target="#products-table-container"
                        hx-swap="innerHTML"
                        hx-trigger="change"
                        hx-include="this"
                        th:attr="hx-vals='{&quot;currentPage&quot;:0}'">
                    <option th:selected="${productsWithDetails.pageSize == 5}" value="5">5 per page</option>
                    <option th:selected="${productsWithDetails.pageSize == 10}" value="10">10 per page</option>
                    <option th:selected="${productsWithDetails.pageSize == 20}" value="20">20 per page</option>
                </select>
            </div>
            <div class="page-navigation">
                <button class="btn btn-outline-primary"
                        th:disabled="${productsWithDetails.currentPage == 0}"
                        th:attr="hx-get=@{/products(currentPage=${productsWithDetails.currentPage - 1},pageSize=${productsWithDetails.pageSize})}"
                        hx-target="#products-table-container"
                        hx-swap="innerHTML">
                    Previous
                </button>
                <button class="btn btn-outline-primary"
                        th:disabled="${productsWithDetails.currentPage + 1 >= productsWithDetails.totalPages}"
                        th:attr="hx-get=@{/products(currentPage=${productsWithDetails.currentPage + 1},pageSize=${productsWithDetails.pageSize})}"
                        hx-target="#products-table-container"
                        hx-swap="innerHTML">
                    Next
                </button>
            </div>
        </div>
    </div>
    <!-- Delete confirmation dialog -->
    <div id="delete-product-confirm"></div>

</div>

</html>