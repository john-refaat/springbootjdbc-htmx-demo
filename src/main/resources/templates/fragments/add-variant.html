<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add Variant</title>
</head>
<body>
<!-- Reusable variant fields fragment -->
<div th:fragment="variant-fields(variantIndex, fieldPrefix, variant)">
    <div class="variant-card">
        <div class="variant-content">
            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_title'}">
                    <i class="fas fa-tag"></i>
                    Variant Title
                </label>
                <input type="text"
                       th:id="${fieldPrefix + '_title'}"
                       th:name="${fieldPrefix + '_title'}"
                       th:value="${variant?.title}"
                       class="form-control variant-title-input"
                       placeholder="e.g., Red Large T-Shirt">
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_externalId'}">External ID</label>
                <input type="text"
                       th:id="${fieldPrefix + '_externalId'}"
                       th:name="${fieldPrefix + '_externalId'}"
                       th:value="${variant?.externalId}"
                       class="form-control">
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_option1'}">Option 1</label>
                <input type="text"
                       th:id="${fieldPrefix + '_option1'}"
                       th:name="${fieldPrefix + '_option1'}"
                       th:value="${variant?.option1}"
                       class="form-control"
                       placeholder="e.g., Color">
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_option2'}">Option 2</label>
                <input type="text"
                       th:id="${fieldPrefix + '_option2'}"
                       th:name="${fieldPrefix + '_option2'}"
                       th:value="${variant?.option2}"
                       class="form-control"
                       placeholder="e.g., Size">
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_option3'}">Option 3</label>
                <input type="text"
                       th:id="${fieldPrefix + '_option3'}"
                       th:name="${fieldPrefix + '_option3'}"
                       th:value="${variant?.option3}"
                       class="form-control"
                       placeholder="e.g., Material">
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_price'}">
                    <i class="fas fa-dollar-sign"></i>
                    Price *
                </label>
                <input type="number"
                       th:id="${fieldPrefix + '_price'}"
                       th:name="${fieldPrefix + '_price'}"
                       th:value="${variant?.price}"
                       class="form-control"
                       step="0.01"
                       min="0"
                       placeholder="0.00">
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_sku'}">
                    SKU
                </label>
                <input type="text"
                       th:id="${fieldPrefix + '_sku'}"
                       th:name="${fieldPrefix + '_sku'}"
                       th:value="${variant?.sku}"
                       class="form-control"
                       placeholder="Product SKU">
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${fieldPrefix + '_available'}">
                    <i class="fas fa-check-circle"></i>
                    Available
                </label>
                <select th:id="${fieldPrefix + '_available'}"
                        th:name="${fieldPrefix + '_available'}"
                        class="form-control">
                    <option value="true" th:selected="${variant?.available == null or variant?.available}">Yes</option>
                    <option value="false" th:selected="${variant?.available != null and !variant?.available}">No</option>
                </select>
            </div>

            <div class="form-group">
                <label th:for="${fieldPrefix + '_imageFile'}"
                       class="form-label">
                    <i class="fas fa-image"></i>
                    Variant Image
                </label>
                <input type="file"
                       th:id="${fieldPrefix + '_imageFile'}"
                       th:name="${fieldPrefix + '_imageFile'}"
                       class="form-control"
                       accept="image/*"
                       th:onchange="'previewVariantImage(this, ' + ${variantIndex} + ')'">
                <div class="image-preview"
                     th:id="${'variant_' + variantIndex + 'imagePreview'}"
                     th:style="${variant?.featuredImage?.src != null ? 'display: block;' : 'display: none;'}">
                    <img th:src="${variant?.featuredImage?.src}"
                         alt="Preview"
                         style="max-width: 100px; max-height: 100px; margin-top: 0.5rem; border-radius: 8px;">
                </div>
            </div>

            <!-- Slot for additional buttons (different per context) -->
            <div class="variant-actions" th:insert="${~{::actions}}">
                <!-- Default: remove button -->
                <button type="button" class="btn btn-danger" onclick="removeVariant(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </div>
</div>


<div th:fragment="variant-row(variantIndex)"
     th:object="${newProduct}"
     class="variant-row new-variant" th:attr="data-variant-index=${variantIndex}">

    <!--<input type="hidden"
           id="variantCount"
           name="variantCount"
           th:value="${variantCount}"
           hx-swap-oob="true"/>-->

    <div class="variant-card">
        <div class="variant-content">
            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_title'}">
                    <i class="fas fa-tag"></i>
                    Variant Title
                </label>
                <input type="text"
                       th:id="${'variant_' + variantIndex + '_title'}"
                       th:name="${'variants_' + variantIndex + '_title'}"
                       th:field="*{product.variants[__${variantIndex}__].title}"
                       class="form-control variant-title-input"
                       th:classappend="${#fields.hasErrors('product.variants[__${variantIndex}__].title') ? 'error-input' : ''}"
                       placeholder="e.g., Red Large T-Shirt">
                <div class="error"
                     th:if="${#fields.hasErrors('product.variants[__${variantIndex}__].title')}"
                     th:errors="*{product.variants[__${variantIndex}__].title}"></div>
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_externalId'}">External ID</label>
                <input type="text"
                       th:id="${'variant_' + variantIndex + '_externalId'}"
                       th:name="${'variant_' + variantIndex + '_externalId'}"
                       th:field="*{product.variants[__${variantIndex}__].externalId}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('product.variants[__${variantIndex}__].externalId') ? 'error-input' : ''}"
                >
                <div class="error" th:if="${#fields.hasErrors('product.variants[__${variantIndex}__].externalId')}"
                     th:errors="*{product.variants[__${variantIndex}__].externalId}"></div>
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_option1'}">Option 1</label>
                <input type="text"
                       th:name="${'variant_' + variantIndex + '_option1'}"
                       th:field="*{product.variants[__${variantIndex}__].option1}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('product.variants[__${variantIndex}__].option1') ? 'error-input' : ''}"
                       placeholder="e.g., Color">
                <div class="error" th:if="${#fields.hasErrors('product.variants[__${variantIndex}__].option1')}"
                     th:errors="*{product.variants[__${variantIndex}__].option1}"></div>
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_option2'}">Option 2</label>
                <input type="text"
                       th:id="${'variant_' + variantIndex + '_option2'}"
                       th:name="${'variant_' + variantIndex + '_option2'}"
                       th:field="*{product.variants[__${variantIndex}__].option2}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('product.variants[__${variantIndex}__].option2') ? 'error-input' : ''}"
                       placeholder="e.g., Size">
                <div class="error" th:if="${#fields.hasErrors('product.variants[__${variantIndex}__].option2')}"
                     th:errors="*{product.variants[__${variantIndex}__].option2}"></div>
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_option3'}">Option 3</label>
                <input type="text"
                       th:id="${'variant_' + variantIndex + '_option3'}"
                       th:name="${'variant_' + variantIndex + '_option3'}"
                       th:field="*{product.variants[__${variantIndex}__].option3}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('product.variants[__${variantIndex}__].option3') ? 'error-input' : ''}"
                       placeholder="e.g., Material">
                <div class="error" th:if="${#fields.hasErrors('product.variants[__${variantIndex}__].option3')}"
                     th:errors="*{product.variants[__${variantIndex}__].option3}"></div>
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_price'}">
                    <i class="fas fa-dollar-sign"></i>
                    Price *
                </label>
                <input type="number"
                       th:id="${'variant_' + variantIndex + '_price'}"
                       th:name="${'variant_' + variantIndex + '_price'}"
                       th:field="*{product.variants[__${variantIndex}__].price}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('product.variants[__${variantIndex}__].price') ? 'error-input' : ''}"
                       step="0.01"
                       min="0"
                       placeholder="0.00">
                <div class="error" th:if="${#fields.hasErrors('product.variants[__${variantIndex}__].price')}"
                     th:errors="*{product.variants[__${variantIndex}__].price}"></div>
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_sku'}">
                    SKU
                </label>
                <input type="text"
                       th:id="${'variant_' + variantIndex + '_sku'}"
                       th:name="${'variant_' + variantIndex + '_sku'}"
                       th:field="*{product.variants[__${variantIndex}__].sku}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('product.variants[__${variantIndex}__].sku') ? 'error-input' : ''}"
                       placeholder="Product SKU">
                <div class="error" th:if="${#fields.hasErrors('product.variants[__${variantIndex}__].sku')}"
                     th:errors="*{product.variants[__${variantIndex}__].sku}"></div>
            </div>

            <div class="form-group">
                <label class="form-label"
                       th:for="${'variant_' + variantIndex + '_available'}">
                    <i class="fas fa-check-circle"></i>
                    Available
                </label>
                <select th:id="${'variant_' + variantIndex + '_available'}"
                        th:name="${'variant_' + variantIndex + '_available'}"
                        th:field="*{product.variants[__${variantIndex}__].available}"
                        class="form-control">
                    <option value="true" selected>Yes</option>
                    <option value="false">No</option>
                </select>
            </div>
            <div class="form-group">
                <label th:for="${'variant_' + variantIndex + '_imageFile'}"
                       class="form-label">
                    <i class="fas fa-image"></i>
                    Variant Image
                </label>

                <input type="file"
                       th:id="${'variant_' + variantIndex + '_imageFile'}"
                       th:name="${'variant_' + variantIndex + '_imageFile'}"
                       th:field="*{product.variants[__${variantIndex}__].imageFile}"
                       class="form-control"
                       accept="image/*"
                       th:onchange="'previewVariantImage(this, ' + ${variantIndex} + ')'">
                <div class="image-preview" th:id="${'variant_' + variantIndex + 'imagePreview'}"
                     style="display: none;">
                    <img src="" alt="Preview"
                         style="max-width: 100px; max-height: 100px; margin-top: 0.5rem; border-radius: 8px;">
                </div>
            </div>

            <div class="variant-actions">
                <button type="button" class="btn btn-danger" onclick="removeVariant(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>