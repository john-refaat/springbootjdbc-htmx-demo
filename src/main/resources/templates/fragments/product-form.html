<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body hx-ext="response-targets">
<div id="product-form" th:fragment="product-form">
    <!-- Add Product Form -->
    <details open>
        <summary>
            <div class="form-header" style="width:100%">
                <h2 class="form-title">
                    <i class="fas fa-plus-circle"></i>
                    Add New Product
                </h2>
            </div>
        </summary>
        <div>
            <wa-dialog id="success-dialog" label="Dialog" th:open="${success}" light-dismiss
                       class="dialog-light-dismiss"
                       hx-on:wa-hide="handleSaveSuccess(this, event)">
                <div th:replace="~{fragments/success :: success-message}"></div>
                <wa-button slot="footer" variant="brand" data-dialog="close">Ok
                </wa-button>
            </wa-dialog>
            <div id="error-container">
                <!--<div th:replace="~{fragments/error :: error-message}"></div>-->
            </div>
            <!-- hx-on::after-request="handleFormSubmit(this, event)"-->
            <form th:hx-post="${newProduct.mode == 'edit' ? '/products/' + newProduct.product.uid +'/update' : '/products/create'}"
                  th:object="${newProduct}"
                  hx-target="#product-form"
                  hx-target-error="#error-container"
                  hx-swap="outerHTML show:top"
                  enctype="multipart/form-data">
                <div class="form-content">
                    <div class="form-grid">
                        <input type="hidden" th:field="*{product.uid}">
                        <div class="form-group">
                            <label for="title" class="form-label">
                                <i class="fas fa-tag"></i>
                                Product Title *
                            </label>
                            <input type="text"
                                   id="title"
                                   name="title"
                                   th:field="*{product.title}"
                                   class="form-control"
                                   th:classappend="${#fields.hasErrors('product.title') ? 'error-input' : ''}"
                                   placeholder="Enter product title">
                            <div class="error" th:if="${#fields.hasErrors('product.title')}"
                                 th:errors="*{product.title}"></div>
                        </div>

                        <div class="form-group">
                            <label for="vendor" class="form-label">
                                <i class="fas fa-building"></i>
                                Vendor/Brand
                            </label>
                            <input type="text"
                                   id="vendor"
                                   name="vendor"
                                   th:field="*{product.vendor}"
                                   class="form-control"
                                   th:classappend="${#fields.hasErrors('product.vendor') ? 'error-input' : ''}"
                                   placeholder="Enter vendor name">
                            <div class="error" th:if="${#fields.hasErrors('product.vendor')}"
                                 th:errors="*{product.vendor}"></div>
                        </div>

                        <div class="form-group">
                            <label for="product_type" class="form-label">
                                <i class="fas fa-layer-group"></i>
                                Product Type
                            </label>
                            <input type="text"
                                   id="product_type"
                                   name="productType"
                                   th:field="*{product.productType}"
                                   class="form-control"
                                   th:classappend="${#fields.hasErrors('product.productType') ? 'error-input' : ''}"
                                   placeholder="e.g., Clothing, Electronics">
                            <div class="error" th:if="${#fields.hasErrors('product.productType')}"
                                 th:errors="*{product.productType}"></div>

                        </div>

                        <div class="form-group">
                            <label for="external_id" class="form-label">
                                <i class="fas fa-external-link-alt"></i>
                                External ID
                            </label>
                            <input type="text"
                                   id="external_id"
                                   name="external_id"
                                   th:field="*{product.externalId}"
                                   class="form-control"
                                   th:classappend="${#fields.hasErrors('product.externalId') ? 'error-input' : ''}"
                                   placeholder="External identifier">
                            <div class="error" th:if="${#fields.hasErrors('product.externalId')}"
                                 th:errors="*{product.externalId}"></div>
                        </div>
                    </div>

                    <div class="variants-section" th:unless="${newProduct.mode == 'edit'}">

                        <div class="variants-header">
                            <h3 class="variants-title">
                                <i class="fas fa-cubes"></i>
                                Product Variants
                            </h3>
                        </div>

                        <input type="hidden" id="variantCount" name="variantCount"/>
                        <input type="checkbox" id="variantVisible0" name="variantVisible[0]" style="display: none;"
                               th:checked="${visibleVariants != null ? visibleVariants[0] : false}"/>
                        <input type="checkbox" id="variantVisible1" name="variantVisible[1]" style="display: none;"
                               th:checked="${visibleVariants != null ? visibleVariants[1] : false}"/>
                        <input type="checkbox" id="variantVisible2" name="variantVisible[2]" style="display: none;"
                               th:checked="${visibleVariants != null ? visibleVariants[2] : false}"/>

                        <div id="variants-container">

                            <div th:each="variantIndex : ${#numbers.sequence(0, 2)}"
                                 th:id="${'variant_' + variantIndex}"
                                 th:style="${visibleVariants != null and visibleVariants[variantIndex] != null and !visibleVariants[variantIndex] ? 'display: none;' : ''}">
                                <div th:insert="~{fragments/add-variant :: variant-row(variantIndex=${variantIndex})}"></div>
                            </div>
                        </div>

                        <!--onclick="addVariant()"-->
                        <button type="button" class="btn add-variant-btn"
                                th:disabled="${variantCount >= 3}"
                                onclick="addVariant()">
                            <i class="fas fa-plus"></i>
                            Add Variant
                        </button>
                    </div>


                    <div class="form-actions">
                        <button type="submit" class="btn btn-submit">
                            <i class="fas fa-save"></i>
                            Save Product
                        </button>
                        <button type="button" class="btn"
                                th:if="${newProduct.mode == 'edit'}" hx-target="#product-form" hx-trigger="click"
                                hx-swap="outerHTML show:top"
                                hx-get="/products/create">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </details>
</div>
</body>
</html>